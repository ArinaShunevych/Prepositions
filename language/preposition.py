import re

# Словник прийменників із групами
prepositions = {
    "первинні": ["без", "в", "від", "для", "до", "з", "за", "на", "над", "під", "по", "при", "про", "заради", "через"],
    "вторинні": ["попід", "понад", "побіля", "поміж", "попри", "поза", "задля", "заради", "з-за", "із-за", "з-під", "з-поза", "з-над", "з-понад", "з-проміж", "з-попід", "з-поміж", "з-серед", "з-посеред", "щодо", "задля"],
    "відіменникові": ["край", "кінець", "коло", "перед", "протягом", "шляхом", "за допомогою", "під час", "у напрямі до", "у напрямку до", "на шляху до", "у зв’язку з", "в силу", "в результаті", "внаслідок"],
    "віддієслівні": ["завдяки", "виключаючи", "незважаючи на"],
    "відприслівникові": ["близько", "внаслідок", "всупереч", "вслід", "услід", "довкола", "кругом", "навкруги", "навпроти", "наприкінці", "напередодні", "навколо", "назустріч", "осторонь", "обабіч", "поперек", "поперед", "посеред", "побіля", "позад", "упродовж", "відповідно до", "залежно від", "згідно з"]
}

# Правила написання прийменників
preposition_rules = {
    "разом": [
        "понад", "попід", "поза", "поміж", "попри", "посеред", "поперед", "побіля", "задля", "заради", "довкола",
        "назустріч", "наприкінці", "услід", "вслід", "внаслідок"
    ],
    "через дефіс": [
        "з-за", "із-за", "з-поза", "з-над", "з-понад", "з-під", "з-попід", "з-поміж", "з-проміж", "з-серед", "з-посеред"
    ],
    "окремо": [
        "згідно з", "залежно від", "незважаючи на", "під час", "в результаті", "в силу", "у напрямі до", "у напрямку до", "на шляху до", "у зв’язку з", "відповідно до"
    ]
}

def get_preposition_rule(preposition):
    for rule, preps in preposition_rules.items():
        if preposition in preps:
            return rule
    return "немає специфічного правила"

def extract_prepositions(text):
    found_prepositions = []

    # Обробка багатослівних прийменників перед розбиттям тексту
    for multi_prep in preposition_rules["окремо"]:
        if multi_prep in text.lower():
            found_prepositions.append((multi_prep, "складений", get_preposition_rule(multi_prep)))
            text = text.lower().replace(multi_prep, "", 1)  # Видаляємо знайдений прийменник

    # Розбиття тексту на слова для одно- або складнослівних прийменників
    words = re.findall(r'\b[\w’-]+\b', text.lower())

    # Обробка одно- або складнослівних прийменників
    for word in words:
        for group, prep_list in prepositions.items():
            if word in prep_list:
                rule = get_preposition_rule(word)
                found_prepositions.append((word, group, rule))
                break

    return found_prepositions